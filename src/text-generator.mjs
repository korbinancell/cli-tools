import { randInt } from "./utils.mjs";

// prettier-ignore
const smallText = { a: "áµƒ", b: "áµ‡", c: "á¶œ", d: "áµˆ", e: "áµ‰", f: "á¶ ", g: "áµ", h: "Ê°", i: "â±", j: "Ê²", k: "áµ", l: "Ë¡", m: "áµ", n: "â¿", o: "áµ’", p: "áµ–", q: "á‘«", r: "Ê³", s: "Ë¢", t: "áµ—", u: "áµ˜", v: "áµ›", w: "Ê·", x: "Ë£", y: "Ê¸", z: "á¶»", A: "áµƒ", B: "áµ‡", C: "á¶œ", D: "áµˆ", E: "áµ‰", F: "á¶ ", G: "áµ", H: "Ê°", I: "â±", J: "Ê²", K: "áµ", L: "Ë¡", M: "áµ", N: "â¿", O: "áµ’", P: "áµ–", Q: "áµ ", R: "Ê³", S: "Ë¢", T: "áµ—", U: "áµ˜", V: "áµ›", X: "Ë£", W: "Ê·", Y: "Ê¸", Z: "á¶»", "`": "`", "~": "~", "!": "ï¹—", "@": "@", "#": "#", $: "ï¹©", "%": "ï¹ª", "^": "^", "&": "ï¹ ", "*": "ï¹¡", "(": "â½", ")": "â¾", _: "â»", "-": "â»", "=": "â¼", "+": "+", "{": "{", "[": "[", "}": "}", "]": "]", ":": "ï¹•", ";": "ï¹”", "?": "ï¹–", 0: "â°", 1: "Â¹", 2: "Â²", 3: "Â³", 4: "â´", 5: "âµ", 6: "â¶", 7: "â·", 8: "â¸", 9: "â¹", };
// prettier-ignore
const smallCaps = { a: "á´€", b: "Ê™", c: "á´„", d: "á´…", e: "á´‡", f: "êœ°", g: "É¢", h: "Êœ", i: "Éª", j: "á´Š", k: "á´‹", l: "ÊŸ", m: "á´", n: "É´", o: "á´", p: "á´˜", q: "q", r: "Ê€", s: "s", t: "á´›", u: "á´œ", v: "á´ ", w: "á´¡", x: "x", y: "Ê", z: "á´¢", A: "A", B: "B", C: "C", D: "D", E: "E", F: "F", G: "G", H: "H", I: "I", J: "J", K: "K", L: "L", M: "M", N: "N", O: "O", P: "P", Q: "Q", R: "R", S: "S", T: "T", U: "U", V: "V", W: "W", X: "X", Y: "Y", Z: "Z", "`": "`", "~": "~", "!": "ï¹—", "@": "@", "#": "#", $: "ï¹©", "%": "ï¹ª", "^": "^", "&": "ï¹ ", "*": "ï¹¡", "(": "â½", ")": "â¾", _: "â»", "-": "â»", "=": "â¼", "+": "+", "{": "{", "[": "[", "}": "}", "]": "]", ":": "ï¹•", ";": "ï¹”", "?": "ï¹–", 0: "0", 1: "1", 2: "2", 3: "3", 4: "4", 5: "5", 6: "6", 7: "7", 8: "8", 9: "9", };
// prettier-ignore
const upsideDown = { a: "É", b: "q", c: "É”", d: "p", e: "Ç", f: "ÉŸ", g: "Æƒ", h: "É¥", i: "Ä±", j: "É¾", k: "Êž", l: "×Ÿ", m: "É¯", n: "u", o: "o", p: "d", q: "b", r: "É¹", s: "s", t: "Ê‡", u: "n", v: "ÊŒ", w: "Ê", x: "x", y: "ÊŽ", z: "z", A: "É", B: "q", C: "É”", D: "p", E: "Ç", F: "ÉŸ", G: "Æƒ", H: "É¥", I: "Ä±", J: "É¾", K: "Êž", L: "×Ÿ", M: "É¯", N: "u", O: "o", P: "d", Q: "b", R: "É¹", S: "s", T: "Ê‡", U: "n", V: "ðŒ¡", X: "x", W: "Ê", Y: "ÊŽ", Z: "z", "`": "`", "~": "~", "!": "Â¡", "@": "@", "#": "#", $: "ï¹©", "%": "ï¹ª", "^": "^", "&": "â…‹", "*": "*", "(": ")", ")": "(", _: "â»", "-": "-", "=": "=", "+": "+", "{": "}", "[": "]", "}": "{", "]": "[", ":": ":", ";": ";", "?": "Â¿", 0: "0", 1: "1", 2: "2", 3: "3", 4: "4", 5: "5", 6: "6", 7: "7", 8: "8", 9: "9", };

// zalgo stuff https://metacpan.org/pod/Acme::Zalgo & https://github.com/Marak/colors.js
// prettier-ignore
const overChars = [ 'Ì', 'ÌŽ', 'Ì„', 'Ì…', 'Ì¿', 'Ì‘', 'Ì†', 'Ì', 'Í’', 'Í—', 'Í‘', 'Ì‡', 'Ìˆ', 'ÌŠ', 'Í‚', 'Íƒ', 'Í„', 'ÍŠ', 'Í‹', 'ÍŒ', 'Ìƒ', 'Ì‚', 'ÌŒ', 'Í', 'Ì€', 'Ì', 'Ì‹', 'Ì', 'Ì’', 'Ì“', 'Ì”', 'Ì½', 'Ì‰', 'Í£', 'Í¤', 'Í¥', 'Í¦', 'Í§', 'Í¨', 'Í©', 'Íª', 'Í«', 'Í¬', 'Í­', 'Í®', 'Í¯', 'Ì¾', 'Í›', 'Í†', 'Ìš' ];
// prettier-ignore
const midChars = [ 'Ì•', 'Ì›', 'Í€', 'Í', 'Í˜', 'Ì¡', 'Ì¢', 'Ì§', 'Ì¨', 'Ì´', 'Ìµ', 'Ì¶', 'Í', 'Íœ', 'Í', 'Íž', 'ÍŸ', 'Í ', 'Í¢', 'Ì¸', 'Ì·', 'Í¡', 'Ò‰' ];
// prettier-ignore
const underChars = [ 'Ì–', 'Ì—', 'Ì˜', 'Ì™', 'Ìœ', 'Ì', 'Ìž', 'ÌŸ', 'Ì ', 'Ì¤', 'Ì¥', 'Ì¦', 'Ì©', 'Ìª', 'Ì«', 'Ì¬', 'Ì­', 'Ì®', 'Ì¯', 'Ì°', 'Ì±', 'Ì²', 'Ì³', 'Ì¹', 'Ìº', 'Ì»', 'Ì¼', 'Í…', 'Í‡', 'Íˆ', 'Í‰', 'Í', 'ÍŽ', 'Í“', 'Í”', 'Í•', 'Í–', 'Í™', 'Íš', 'Ì£' ];

const zalgoRegex = RegExp(`(${[...overChars, ...midChars, ...underChars].join("|")})`, "g");

const segment = (text) => [...new Intl.Segmenter().segment(text)].map((c) => c.segment);

export const toSmallText = (text) =>
  segment(text)
    .map((c) => smallText[c] ?? c)
    .join("");

export const toSmallCaps = (text) =>
  segment(text)
    .map((c) => smallCaps[c] ?? c)
    .join("");

export const toUpsideDown = (text) =>
  segment(text)
    .map((c) => upsideDown[c] ?? c)
    .reverse()
    .join("");

export const zalgoize = (text, intensity) =>
  segment(text)
    .map((c) => {
      // emoji or already weird
      if (c.length > 1 || zalgoRegex.test(c) || c === " ") return c;

      const up = randInt(16 * intensity) + 1;
      const mid = randInt(6 * intensity);
      const dn = randInt(16 * intensity) + 1;
      for (let [count, chars] of [
        [up, overChars],
        [mid, midChars],
        [dn, underChars],
      ]) {
        while (count-- > 0) {
          c += chars[randInt(chars.length - 1)];
        }
      }

      return c;
    })
    .join("");
